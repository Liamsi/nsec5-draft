<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY rfc4033 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4033.xml">
<!ENTITY rfc5155 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5155.xml">
<!ENTITY rfc2119 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY rfc4648 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4648.xml">
]>
<?rfc toc="yes"?>
<?rfc symrefs="yes"?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>
<?rfc strict="no"?>
<?rfc rfcedstyle="yes"?>
<?rfc comments="yes"?>
<?rfc inline="yes"?>

<rfc category="std" docName="draft-jvcelak-nsec5-00" ipr="trust200902">
    <front>
        <title abbrev="NSEC5">NSEC5, DNSSEC Authenticated Denial of Existence</title>

        <author fullname="Jan Vcelak" initials="J" surname="Vcelak">
            <organization>CZ.NIC</organization>
            <address>
                <postal>
                    <street>Milesovska 1136/5</street>
                    <city>Praha</city>
                    <code>130 00</code>
                    <country>CZ</country>
                </postal>
                <email>jan.vcelak@nic.cz</email>
            </address>
        </author>

        <author fullname="Sharon Goldberg" initials="S" surname="Goldberg">
            <organization>Boston University</organization>
            <address>
                <postal>
                    <street>111 Cummington St, MCS135</street>
                    <city>Boston</city>
                    <region>MA</region>
                    <code>02215</code>
                    <country>USA</country>
                </postal>
                <email>goldbe@cs.bu.edu</email>
            </address>
        </author>

        <date year="2015" />

        <!-- <workgroup></workgroup> -->

        <keyword>DNS</keyword>
        <keyword>DNSSEC</keyword>
        <keyword>NSEC</keyword>

    <abstract>

        <!--
            Keep it brief. Remember, don't put any citations in the abstract, and expand your  acronyms.
        <-->

        <t>
            The Domain Name System Security (DNSSEC) Extensions introduced the NSEC resource
            record (RR) for authenticated denial of existence and the NSEC3 for hashed
            authenticated denial of existence.

            The NSEC allows zone content enumeration by quering the server for carefully chosen
            domain names. The NSEC3 adds domain name hashing, which makes the zone enumeration
            harder, but not impossible.

            This document introduces NSEC5, which provides an cryptographically-proven mechanism
            preventing zone enumeration.
        </t>

    </abstract>

</front>

<middle>
    <section title="Introduction">

        <section title="Rationale">

            <!--
                You can echo the abstract in the Introduction, providing citations here, but you
                should provide more than just the abstract.
            -->

            <t>
                The DNS Security Extensions (DNSSEC) provides data integrity protection using
                public-key cryptography while not requiring the servers to compute the signatures
                on-the-fly. The content of the zone is usually pre-computed and served as it is.
                The evident advantage of this approach is reduced performance requirements per
                query. Also the private keys security is higher because the keys do not have to
                be present on the servers facing the network.
            </t>

            <t>
                With DNSSEC, each resource record (RR) set in the zone is signed. The signature
                is retained as an RRSIG RR directly in the zone. This enables data integrity
                for positive lookups in the zone. To ensure integrity of denying answers, an
                NSEC chain of all existing domain names in the zone is constructed. The chain
                is made of RRs, where each RR represents two consecutive domain names in
                canonical order present in the zone. The NSEC RRs are signed the same way as
                any other RRs in the zone.
            </t>

            <t>
                A side-effect of the existence of the NSEC chain is a possibility to enumerate
                the content of the zone by following individual RRs in the chain. To prevent
                the zone enumeration, the NSEC3 hashed denial of existence was introduced. The
                domain names in the chain are replaced by their cryptographic hashes. As the
                domain name space is restricted, offline attacks are possible and the zone
                enumeration is harder but still possible.
            </t>

            <t>
                There is a mechanism called NSEC white lies, which completely prevents zone
                content enumeration. The NSEC (or NSEC3) RRs are computed by the authoritative
                server on-the-fly. On the other hand, this mechanism requires presence of
                the private keys on all servers authoritative for the zone, which is often
                undesirable. The holder of the private key can tamper with the zone content.
            </t>

            <t>
                To assure zone content enumeration without keeping private keys on all
                authoritative servers, NSEC5 introduces a public-key based domain name hashing.
                For the hashing, a separate NSEC5 key is used. This key is present on all
                authoritative servers, however holder of the key cannot modify the content of
                the zone.
            </t>

            <t>
                <cref>
                    TODO: What will happen, if the attacked acquires the NSEC5 key? He/she
                    won't be able to enumerate the zone anyway. Right?
                </cref>
            </t>
        </section>

        <section title="Requirements">
            <t>
                The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
                "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
                document are to be interpreted as described in
                <xref target="RFC2119"></xref>.
            </t>
        </section>

        <section title="Terminology">
            <t>
                <cref>TODO: reader should be familiar with DNSSEC and NSEC3 RFCs</cref>

                <list style="hanging">
                    <t hangText="NSEC5 proof-hash:">
                        A signed hash of a domain name (hash-and-sign paradigm). A holder of the
                        private key (e.g., authoritative server) can compute the hash. Anyone
                        knowing the public key (e.g., client) can verify it's validity.
                    </t>
                    <t hangText="NSEC5 chain-hash:">
                        A hash of an NSEC5 proof-hash. If the NSEC5 proof-hash is known, anyone
                        can compute it's NSEC5 chain-hash.
                    </t>
                    <t hangText="Base32hex:">
                        The "Base 32 Encoding with Extended Hex Alphabet" as specified
                        in <xref target="RFC4648"></xref>. The padding characters ("=") are not
                        used in NSEC5 specification.
                    </t>
                    <t hangText="Base64:">
                        The "Base 64 Encoding" as specified in <xref target="RFC4648"></xref>.
                    </t>
                </list>
            </t>
        </section>

    </section>

    <section title="The NSEC5KEY Resource Record">
        <t>
            NSEC5 uses domain name hashing based on public key cryptography.
            Keys used for the NSEC5 hashing differ from keys used to sign and
            verify RRs in a zone.
        </t>

        <t>
            A public key for NSEC5 is stored in NSEC5KEY RRs in the zone apex.
        </t>

        <section title="NSEC5KEY RDATA Wire Format">
            <t>
                The RDATA for NSEC5KEY RR is as shown below:
            </t>

            <figure align="center">
                <artwork><![CDATA[
                     1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 3 3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Algorithm   |                  Public Key                   /
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                ]]></artwork>
            </figure>

            <t>
                Algorithm is a single octet identifying NSEC5 hashing algorithm.
            </t>
            <t>
                Public Key is a variable sized field holding public key material
                used for NSEC5 hashing.
            </t>
        </section>

        <section title="NSEC5KEY RDATA Presentation Format">
            <t>
                The presentation format of the NSEC5KEY RDATA is as follows:
            </t>

            <t>
                The Algorithm field is represented as na unsigned decimal integer.
            </t>

            <t>
                The Public Key field is represented in Base64 encoding. Whitespace
                is allowed within the Base64 text.
            </t>
        </section>
    </section>

    <section title="The NSEC5 Resource Record">
        <t>
            Placeholder...
        </t>

        <t>
            Placeholder...
        </t>

        <t>
            Placeholder...
        </t>

        <section title="NSEC5 RDATA Wire Format">
            <t>
                The RDATA for NSEC5 RR is as shown below:
            </t>

            <figure align="center">
                <artwork><![CDATA[
                     1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 3 3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|            Key Tag            |     Flags     |  Next Length  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     Next Hashed Owner Name                    /
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
/                         Type Bit Maps                         /
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                ]]></artwork>
            </figure>

            <t>
                Key Tag field contains the key tag value of the NSEC5KEY RR
                that validates the NSEC5 RR, in network byte order.
            </t>
            <t>
                Flags field is a single octet. The meaning of individual bits
                of the field is defined in <xref target="nsec5_flags"></xref>.
            </t>
            <t>
                Next length is an unsigned single octet specifying the length
                of the Next Hashed Owner Name field in octets.
            </t>
            <t>
                Next Hashed Owner Name field is a sequence of binary octets.
                It contains a result of NSEC5 chain-hashing of the next domain
                name in the NSEC5 chain.
            </t>
            <t>
                Type Bit Maps is a variable sized field encoding RR types
                present at the original owner name matching the NSEC5 RR.
                The format of the field is equivalent to the format used
                in NSEC3 RR, described in <xref target="RFC5155"></xref>.
            </t>
        </section>

        <section title="NSEC5 Flags Field" anchor="nsec5_flags">
            <t>
                The following one-bit NSEC5 flags are defined:
            </t>

            <figure align="center">
                <artwork><![CDATA[
 0 1 2 3 4 5 6 7
+-+-+-+-+-+-+-+-+
|           |W|O|
+-+-+-+-+-+-+-+-+
                ]]></artwork>
            </figure>

            <t>
                <list>
                    <t>O - Opt-Out flag</t>
                    <t>W - Wildcard flag</t>
                </list>
            </t>
            <t>
                All other flags are reserverd for future use and must be zero.
            </t>
        </section>

        <section title="NSEC5 RDATA Presentation Format">
            <t>
                The presentation format of the NSEC5 RDATA is as follows:
            </t>

            <t>
                The Key Tag field is represented as an unsigned decimal integer.
            </t>

            <t>
                The Flags field is represented as an unsigned decimal integer.
            </t>

            <t>
                The Next Length field is not represented.
            </t>

            <t>
                The Next Hashed Owner Name field is represented as a sequence
                of case-insensitive Base32hex digits without whitespaces and
                without padding.
            </t>

            <t>
                The Type Bit Maps representation is equivalent to the representation
                used in NSEC3 RR, described in <xref target="RFC5155"></xref>.
            </t>
        </section>
    </section>

    <section title="The NSEC5PROOF Resource Record">
        <t>
            The NSEC5PROOF record is synthesised by the authoritative server.
            The record proves a position of the owner name in relation to the
            NSEC5 chain.
        </t>

        <section title="NSEC5PROOF RDATA Wire Format">
            <t>
                The RDATA for NSEC5PROOF is as as shown below:
            </t>

            <figure align="center">
                <artwork><![CDATA[
                     1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 3 3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|            Key Tag            |        Owner Name Hash        /
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                ]]></artwork>
            </figure>

            <t>
                Key Tag field contains the key tag value of the NSEC5KEY RR
                that validates the NSEC5PROOF RR, in network byte order.
            </t>
            <t>
                Owner Name Hash is a variable sized sequence of binary octets
                encoding the NSEC5 proof-hash of the owner name.
            </t>
        </section>

        <section title="NSEC5PROOF RDATA Presentation Format">
            <t>
                The presentation format of the NSEC5PROOF RDATA is as follows:
            </t>

            <t>
                The Key Tag field is represented as an unsigned decimal integer.
            </t>

            <t>
                The Owner Name Hash is represented in Base64 encoding. Whitespace
                is allowed within the Base64 text.
            </t>
        </section>
    </section>

    <section title="Transition Mechanism">
    </section>

    <section title="Authoritative Server Considerations">
    </section>

    <section title="Resolver Considerations">
    </section>

    <section title="Validator Considerations">
    </section>

    <section title="Special Considerations">
    </section>

    <section title="Performance Considerations">
    </section>

    <section title="Security Considerations">
    </section>

    <section title="IANA Considerations">

        <t>
            This document updates the IANA registry "Domain Name System (DNS)
            Parameters" in subregistry "Resource Record (RR) TYPEs", by
            defining the following new RR types:
        </t>

        <t>
            <list>
                <t>NSEC5KEY   value XXX.</t>
                <t>NSEC5      value XXX.</t>
                <t>NSEC5PROOF value XXX.</t>
            </list>
        </t>

        <t>
            This document creates a new IANA registry for NSEC5 hash algorithms.
            This registry is named "DNSSEC NSEC5 Hash Algorithms". The initial
            content of the registry is:
        </t>

        <t>
            <list>
                <t>0     is Reserved.</t>
                <t>1     is FDH-SHA256-SHA256.</t>
                <t>2-255 is Available for assignment.</t>
            </list>
        </t>
    </section>

    <section title="Contributors">
        <t><cref>
            [TEMPLATE TODO] This optional section can be used to mention contributors
            to your internet draft.
        </cref></t>
    </section>

</middle>

<back>

    <!-- References Section -->

<!--
     Section 4.7f of [RFC2223bis] specifies the requirements for the
     references sections.  In particular, there MUST be separate lists of
     normative and informative references, each in a separate section.
     The style SHOULD follow that of recently published RFCs.

     In general, each normative reference SHOULD reference the most recent
     version of the specification in question.
-->

    <references title="Normative References">
        &rfc4033;
        &rfc5155;
        &rfc2119;
        &rfc4648;
    </references>

    <references title="Informative References">

        <reference anchor="nsec5">
            <front>
                <title>NSEC5: Provably Preventing DNSSEC Zone Enumeration</title>
                <author initials="S" surname="Goldberg"><organization></organization></author>
                <author initials="M" surname="Naor"><organization></organization></author>
                <author initials="D" surname="Papadopoulos"><organization></organization></author>
                <author initials="L" surname="Reyzin"><organization></organization></author>
                <author initials="S" surname="Vasant"><organization></organization></author>
                <author initials="A" surname="Ziv"><organization></organization></author>
                <date year="2014" month="July"></date>
            </front>
        </reference>

    </references>

    <section title="Change Log">
        <t>
            Note to RFC Editor: if this document does not obsolete an existing RFC,
            please remove this appendix before publication as an RFC.
        </t>
    </section>

    <section title="Open Issues">
        <t>
            Note to RFC Editor: please remove this appendix before publication as an RFC.
        </t>

        <t>
            <list style="numbers">
                <t>Contributor list has to be completed</t>
            </list>
        </t>
    </section>
  </back>
</rfc>
<!-- vim: et ts=4 sts=4 sw=4 colorcolumn=100 :
-->
