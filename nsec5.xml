<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY rfc1034 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.1034.xml">
<!ENTITY rfc1035 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.1035.xml">
<!ENTITY rfc2119 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY rfc2136 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2136.xml">
<!ENTITY rfc2181 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2181.xml">
<!ENTITY rfc2308 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2308.xml">
<!ENTITY rfc4033 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4033.xml">
<!ENTITY rfc4034 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4034.xml">
<!ENTITY rfc4035 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4035.xml">
<!ENTITY rfc4648 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4648.xml">
<!ENTITY rfc5155 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5155.xml">
<!ENTITY rfc6781 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.6781.xml">
<!ENTITY rfc7129 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.7129.xml">
]>
<?rfc toc="yes"?>
<?rfc symrefs="yes"?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>
<?rfc strict="no"?>
<?rfc rfcedstyle="yes"?>
<?rfc comments="yes"?>
<?rfc inline="yes"?>

<rfc category="std" docName="draft-jvcelak-nsec5-00" ipr="trust200902">
    <front>
        <title abbrev="NSEC5">NSEC5, DNSSEC Authenticated Denial of Existence</title>

        <author fullname="Jan Vcelak" initials="J" surname="Vcelak">
            <organization>CZ.NIC</organization>
            <address>
                <postal>
                    <street>Milesovska 1136/5</street>
                    <city>Praha</city>
                    <code>130 00</code>
                    <country>CZ</country>
                </postal>
                <email>jan.vcelak@nic.cz</email>
            </address>
        </author>

        <author fullname="Sharon Goldberg" initials="S" surname="Goldberg">
            <organization>Boston University</organization>
            <address>
                <postal>
                    <street>111 Cummington St, MCS135</street>
                    <city>Boston</city>
                    <region>MA</region>
                    <code>02215</code>
                    <country>USA</country>
                </postal>
                <email>goldbe@cs.bu.edu</email>
            </address>
        </author>

        <date year="2015" />

        <!-- <workgroup></workgroup> -->

        <keyword>DNS</keyword>
        <keyword>DNSSEC</keyword>
        <keyword>NSEC</keyword>

    <abstract>

        <!--
            Keep it brief. Remember, don't put any citations in the abstract, and expand your  acronyms.
        <-->

        <t>
            The Domain Name System Security (DNSSEC) Extensions introduced the NSEC resource
            record (RR) for authenticated denial of existence and the NSEC3 for hashed
            authenticated denial of existence.

            The NSEC allows zone content enumeration by quering the server for carefully chosen
            domain names. The NSEC3 adds domain name hashing, which makes the zone enumeration
            harder, but not impossible.

            This document introduces NSEC5, which provides an cryptographically-proven mechanism
            preventing zone enumeration.
        </t>

    </abstract>

</front>

<middle>
    <section title="Introduction">

        <section title="Rationale">

            <!--
                You can echo the abstract in the Introduction, providing citations here, but you
                should provide more than just the abstract.
            -->

            <t>
                The DNS Security Extensions (DNSSEC) provides data integrity protection using
                public-key cryptography while not requiring the servers to compute the signatures
                on-the-fly. The content of the zone is usually pre-computed and served as it is.
                The evident advantage of this approach are reduced performance requirements per
                query. Also the private keys security is higher because the keys do not have to
                be present on the servers facing the network.
            </t>

            <t>
                With DNSSEC, each resource record (RR) set in the zone is signed. The signature
                is retained as an RRSIG RR directly in the zone. This enables response
                authentication for data existing in the zone. To ensure integrity of denying
                answers, an NSEC chain of all existing domain names in the zone is constructed.
                The chain is made of RRs, where each RR represents two consecutive domain names in
                canonical order present in the zone. The NSEC RRs are signed the same way as
                any other RRs in the zone, and each NSEC can be used to prove, that a given
                name doesn't existing in a part of the domain name space.
            </t>

            <t>
                A side-effect of the NSEC chain existence is a possibility to enumerate
                the content of the zone by following individual RRs in the chain. To prevent
                the zone enumeration, the NSEC3 hashed denial of existence was introduced.
                In NSEC3, original domain names are replaced by their cryptographic hashes
                in the chain. However, the domain name space is restricted and offline attacks
                are possible. The zone enumeration with NSEC3 is more difficult, but still
                possible.
            </t>

            <t>
                There are means to prevent zone enumeration with NSEC or NSEC3. The RRs for
                denying answers can be computed by the authoritative server on-the-fly. Usually,
                this mean is called Minimally Covering NSEC3 Records or NSEC3 White Lies
                <xref target="RFC7129" />. One of the most significant disadvantage of this
                approach is a required presence of the private key on all authoritative servers
                for the zone. This is often undesirable, as the holder of the private key can
                tamper with the zone content.
            </t>

            <t>
                To prevent zone content enumeration without keeping private keys on all
                authoritative servers, NSEC5 introduces a public-key based domain name hashing.
                For the hashing, a separate NSEC5 key is used. This key is present on all
                authoritative servers, however holder of the key cannot modify the content of
                the zone.
            </t>

            <t>
                <cref>
                    TODO: What will happen, if the attacked acquires the NSEC5 key? He/she
                    won't be able to enumerate the zone anyway. Right?
                </cref>
            </t>

            <t>
                The NSEC5 is not intended to replace NSEC or NSEC3. It is designed as an
                alternative mechanisms for authenticated denial of existence.
            </t>
        </section>

        <section title="Requirements">
            <t>
                The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
                "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
                document are to be interpreted as described in
                <xref target="RFC2119" />.
            </t>
        </section>

        <section title="Terminology">

            <t>
                The reader is assumed to be familiar with the basic DNS and DNSSEC concepts
                described in
                <xref target="RFC1034" />,
                <xref target="RFC1035" />,
                <xref target="RFC4033" />,
                <xref target="RFC4034" />,
                <xref target="RFC4035" />, and subsequent RFCs that update them:
                <xref target="RFC2136" />,
                <xref target="RFC2181" />,
                <xref target="RFC2308" />, and
                <xref target="RFC5155" />.
            </t>

            <t>
                The following terminology is used through this document:
            </t>

            <t>
                <list style="hanging">
                    <t hangText="Base32hex:">
                        The "Base 32 Encoding with Extended Hex Alphabet" as specified
                        in <xref target="RFC4648" />. The padding characters ("=") are not
                        used in NSEC5 specification.
                    </t>
                    <t hangText="Base64:">
                        The "Base 64 Encoding" as specified in <xref target="RFC4648" />.
                    </t>
                    <t hangText="NSEC5 proof-hash:">
                        A signed hash of a domain name (hash-and-sign paradigm). A holder of the
                        private key (e.g., authoritative server) can compute the hash. Anyone
                        knowing the public key (e.g., client) can verify it's validity.
                    </t>
                    <t hangText="NSEC5 chain-hash:">
                        A cryptographic hash (digest) of an NSEC5 proof-hash. If the NSEC5
                        proof-hash is known, anyone can compute and verify it's NSEC5 chain-hash.
                    </t>
                </list>
            </t>
        </section>

    </section>

    <section title="Backward Compatibility">
        <t>
            The specification describes a protocol change that is not backward compatible
            with <xref target="RFC4035" /> and <xref target="RFC5155" />. NSEC5-unaware
            resolver will fail to validate responses introduced by this document.
        </t>

        <t>
            To prevent NSEC5-unaware resolvers from attempting to validate the responses, new
            DNSSEC algorithms identifiers are introduced, the identifiers alias with existing
            algorithm numbers. The zones signed according to this specification MUST use only
            these algorithm identifiers, thus NSEC5-unaware resolvers will treat the zone as
            insecure.
        </t>

        <t>
            The new algorithm identifiers defined by this document are listed in
            <xref target="iana_considerations" />.
        </t>
    </section>

    <section title="NSEC5 Principle">
        <t>
            To prove non-existence of a domain name in a zone, NSEC uses a chain built from
            domain names present in the zone. NSEC3 replaces the original domain names by
            their cryptographic hashes. NSEC5 is very similar to NSEC3, however a public-key
            based hashing scheme is used.
        </t>

        <t>
            In NSEC5, the original domain name is hashed twice:
        </t>

        <t>
            <list style="numbers">
                <t>
                    The input of the first hashing is an original domain name and an NSEC5 private
                    key. The result is called NSEC5 proof-hash. Only an authoritative server
                    (knowing the private key) can compute the hash and any client (knowing the
                    public key) can verify the hash's validity.
                </t>
                <t>
                    The second hash is a cryptographic hash of the NSEC5-proof, which results
                    into an NSEC5 chain-hash. The hash can be computed by any party, if the input
                    is known.
                </t>
            </list>
        </t>

        <t>
            The final position of a domain name in an NSEC5 chain is determined by it's NSEC5
            chain-hash. The NSEC5-proof hash is sent by a server in some responses, to prove
            a client about the actual position of the name in the chain.
        </t>

    </section>

    <section title="The NSEC5KEY Resource Record">
        <t>
            NSEC5 uses domain name hashing based on public-key cryptography. Keys used for the
            NSEC5 hashing differ from keys used to sign and verify RRs in a zone.
        </t>

        <t>
            A public key for NSEC5 is stored in NSEC5KEY RRs in the zone apex.
        </t>

        <section title="NSEC5KEY RDATA Wire Format">
            <t>
                The RDATA for NSEC5KEY RR is as shown below:
            </t>

            <figure align="center">
                <artwork><![CDATA[
                     1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 3 3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Algorithm   |                  Public Key                   /
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                ]]></artwork>
            </figure>

            <t>
                Algorithm is a single octet identifying NSEC5 hashing algorithm.
            </t>
            <t>
                Public Key is a variable sized field holding public key material
                used for NSEC5 hashing.
            </t>
        </section>

        <section title="NSEC5KEY RDATA Presentation Format">
            <t>
                The presentation format of the NSEC5KEY RDATA is as follows:
            </t>

            <t>
                The Algorithm field is represented as na unsigned decimal integer.
            </t>

            <t>
                The Public Key field is represented in Base64 encoding. Whitespace
                is allowed within the Base64 text.
            </t>
        </section>
    </section>

    <section title="The NSEC5 Resource Record">
        <t>
            Placeholder...
        </t>

        <t>
            Placeholder...
        </t>

        <t>
            Placeholder...
        </t>

        <section title="NSEC5 RDATA Wire Format">
            <t>
                The RDATA for NSEC5 RR is as shown below:
            </t>

            <figure align="center">
                <artwork><![CDATA[
                     1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 3 3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|            Key Tag            |     Flags     |  Next Length  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     Next Hashed Owner Name                    /
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
/                         Type Bit Maps                         /
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                ]]></artwork>
            </figure>

            <t>
                Key Tag field contains the key tag value of the NSEC5KEY RR
                that validates the NSEC5 RR, in network byte order.
            </t>
            <t>
                Flags field is a single octet. The meaning of individual bits
                of the field is defined in <xref target="nsec5_flags"></xref>.
            </t>
            <t>
                Next length is an unsigned single octet specifying the length
                of the Next Hashed Owner Name field in octets.
            </t>
            <t>
                Next Hashed Owner Name field is a sequence of binary octets.
                It contains a result of NSEC5 chain-hashing of the next domain
                name in the NSEC5 chain.
            </t>
            <t>
                Type Bit Maps is a variable sized field encoding RR types
                present at the original owner name matching the NSEC5 RR.
                The format of the field is equivalent to the format used
                in NSEC3 RR, described in <xref target="RFC5155"></xref>.
            </t>
        </section>

        <section title="NSEC5 Flags Field" anchor="nsec5_flags">
            <t>
                The following one-bit NSEC5 flags are defined:
            </t>

            <figure align="center">
                <artwork><![CDATA[
 0 1 2 3 4 5 6 7
+-+-+-+-+-+-+-+-+
|           |W|O|
+-+-+-+-+-+-+-+-+
                ]]></artwork>
            </figure>

            <t>
                <list>
                    <t>O - Opt-Out flag</t>
                    <t>W - Wildcard flag</t>
                </list>
            </t>
            <t>
                All other flags are reserverd for future use and must be zero.
            </t>
        </section>

        <section title="NSEC5 RDATA Presentation Format">
            <t>
                The presentation format of the NSEC5 RDATA is as follows:
            </t>

            <t>
                The Key Tag field is represented as an unsigned decimal integer.
            </t>

            <t>
                The Flags field is represented as an unsigned decimal integer.
            </t>

            <t>
                The Next Length field is not represented.
            </t>

            <t>
                The Next Hashed Owner Name field is represented as a sequence
                of case-insensitive Base32hex digits without whitespaces and
                without padding.
            </t>

            <t>
                The Type Bit Maps representation is equivalent to the representation
                used in NSEC3 RR, described in <xref target="RFC5155" />.
            </t>
        </section>
    </section>

    <section title="The NSEC5PROOF Resource Record">
        <t>
            The NSEC5PROOF record is synthesised by the authoritative server.
            The record proves a position of the owner name in relation to the
            NSEC5 chain.
        </t>

        <section title="NSEC5PROOF RDATA Wire Format">
            <t>
                The RDATA for NSEC5PROOF is as as shown below:
            </t>

            <figure align="center">
                <artwork><![CDATA[
                     1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 3 3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|            Key Tag            |        Owner Name Hash        /
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                ]]></artwork>
            </figure>

            <t>
                Key Tag field contains the key tag value of the NSEC5KEY RR
                that validates the NSEC5PROOF RR, in network byte order.
            </t>
            <t>
                Owner Name Hash is a variable sized sequence of binary octets
                encoding the NSEC5 proof-hash of the owner name.
            </t>
        </section>

        <section title="NSEC5PROOF RDATA Presentation Format">
            <t>
                The presentation format of the NSEC5PROOF RDATA is as follows:
            </t>

            <t>
                The Key Tag field is represented as an unsigned decimal integer.
            </t>

            <t>
                The Owner Name Hash is represented in Base64 encoding. Whitespace
                is allowed within the Base64 text.
            </t>
        </section>
    </section>

    <section title="Authoritative Server Considerations">
    </section>

    <section title="Resolver Considerations">
    </section>

    <section title="Validator Considerations">
    </section>

    <section title="Special Considerations">

        <section title="Transition Mechanism">
            <t>
                The NSEC5 MUST not be used in parallel with any older NSEC mechanism.
            </t>

            <t>
                The answering server MUST use exactly one NSEC5 chain.
            </t>

            <t>
                <cref>TODO: Transition from NSEC or NSEC3</cref>
            </t>

            <t>
                <cref>TODO: Transition from NSEC5 to NSEC/NSEC3</cref>
            </t>

            <t>
                <cref>TODO: transition to new algorithms withtin NSEC5</cref>
            </t>

        </section>

        <section title="NSEC5 Private Keys">
            <t>
                This document does not define format to store NSEC5 private key. Use of
                standardized and adopted format is RECOMMENDED.
            </t>

            <t>
                This document does not define mechanism to distribute NSEC5 private keys.
            </t>
        </section>

        <section title="NSEC5KEY Rollover Mechanism">
            <t>
                Replacement of the NSEC5 key implies generating a new NSEC5 chain. The NSEC5KEY
                rollover mechanism is similar to "Pre-Publish Zone Signing Key Rollover" as
                specified in <xref target="RFC6781"></xref>. The NSEC5KEY rollover MUST be
                performed as a sequence of the following steps:
            </t>

            <t>
                <list style="numbers">
                    <t>
                        New public key is added into the NSEC5KEY RRset in the zone apex.
                    </t>
                    <t>
                        Existing NSEC5 chain is instantly replaced by a new NSEC5 chain
                        constructed using the new key.
                    </t>
                    <t>
                        The old public key is removed from the NSEC5KEY RRset in the zone apex.
                    </t>
                </list>
            </t>

            <t>
                The minimal delay between the steps 1. and 2. MUST be the time it takes for the
                data to propagate to the authoritative servers, plus the TTL value of the
                NSEC5KEY RRset.
            </t>

            <t>
                The steps 2. and 3. can be performed simultaneously, without a delay.
            </t>
        </section>

        <section title="Domain Name Length Restrictions">

            <t>

            </t>

        </section>

    </section>

    <section title="Performance Considerations">
    </section>

    <section title="Security Considerations">

        <t><cref>TODO: attacks</cref></t>

        <t><cref>TODO: hash collisions</cref></t>

        <t><cref>TODO: recommended key sizes</cref></t>

        <t><cref>TODO: private key protection</cref></t>

        <t><cref>TODO: what if defined algorithm (RSA/FDH) is broken</cref></t>

    </section>

    <section title="IANA Considerations" anchor="iana_considerations">

        <t>
            This document updates the IANA registry "Domain Name System (DNS)
            Parameters" in subregistry "Resource Record (RR) TYPEs", by
            defining the following new RR types:
        </t>

        <t>
            <list>
                <t>NSEC5KEY   value XXX.</t>
                <t>NSEC5      value XXX.</t>
                <t>NSEC5PROOF value XXX.</t>
            </list>
        </t>

        <t>
            This document creates a new IANA registry for NSEC5 hash algorithms.
            This registry is named "DNSSEC NSEC5 Hash Algorithms". The initial
            content of the registry is:
        </t>

        <t>
            <list>
                <t>0     is Reserved.</t>
                <t>1     is FDH-SHA256-SHA256.</t>
                <t>2-255 is Available for assignment.</t>
            </list>
        </t>

        <t>
            This document updates the IANA registry "DNS Security Algorithm Numbers" by
            defining following aliases:
        </t>

        <t>
            <list>
                <t>XXX is NSEC5-RSASHA256, alias for RSASHA256 (8).</t>
                <t>XXX is NSEC5-RSASHA512, alias for RSASHA512 (10).</t>
                <t>XXX is NSEC5-ECDSAP256SHA256 alias for ECDSAP256SHA256 (13).</t>
                <t>XXX is NSEC5-ECDSAP384SHA384 alias for ECDSAP384SHA384 (14).</t>
            </list>
        </t>
    </section>

    <section title="Contributors">
        <t><cref>
            [TEMPLATE TODO] This optional section can be used to mention contributors
            to your internet draft.
        </cref></t>
    </section>

</middle>

<back>

    <!-- References Section -->

<!--
     Section 4.7f of [RFC2223bis] specifies the requirements for the
     references sections.  In particular, there MUST be separate lists of
     normative and informative references, each in a separate section.
     The style SHOULD follow that of recently published RFCs.

     In general, each normative reference SHOULD reference the most recent
     version of the specification in question.
-->

    <references title="Normative References">
        &rfc1034;
        &rfc1035;
        &rfc2119;
        &rfc2136;
        &rfc2181;
        &rfc2308;
        &rfc4033;
        &rfc4034;
        &rfc4035;
        &rfc4648;
        &rfc5155;
    </references>

    <references title="Informative References">

        <reference anchor="nsec5">
            <front>
                <title>NSEC5: Provably Preventing DNSSEC Zone Enumeration</title>
                <author initials="S" surname="Goldberg"><organization></organization></author>
                <author initials="M" surname="Naor"><organization></organization></author>
                <author initials="D" surname="Papadopoulos"><organization></organization></author>
                <author initials="L" surname="Reyzin"><organization></organization></author>
                <author initials="S" surname="Vasant"><organization></organization></author>
                <author initials="A" surname="Ziv"><organization></organization></author>
                <date year="2014" month="July"></date>
            </front>
        </reference>

        &rfc6781;
        &rfc7129;

    </references>

    <section title="Change Log">
        <t>
            Note to RFC Editor: if this document does not obsolete an existing RFC,
            please remove this appendix before publication as an RFC.
        </t>
    </section>

    <section title="Open Issues">
        <t>
            Note to RFC Editor: please remove this appendix before publication as an RFC.
        </t>

        <t>
            <list style="numbers">
                <t>Contributor list has to be completed</t>
            </list>
        </t>
    </section>
  </back>
</rfc>
<!-- vim: et ts=4 sts=4 sw=4 colorcolumn=100 :
-->
